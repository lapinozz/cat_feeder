(()=>{"use strict";const n=JSON.parse('{"enums":{"Commands":{"_ESP_BEGIN":0,"ESP_Capture":0,"ESP_SetDispensingSetting":1,"ESP_SaveDispensingSettings":2,"_ESP_END":3,"_ESP_COUNT":3,"_ARD_BEGIN":4,"ARD_Tare":4,"ARD_ResetTare":5,"ARD_Weight":6,"ARD_Dispense":7,"ARD_SetWheelPosition":8,"ARD_SetSplitterPosition":9,"_ARD_END":10,"_ARD_COUNT":6},"WheelPosition":{"_BEGIN":0,"OPEN":0,"CLOSE_LOOSER":1,"CLOSE_LOOSE":2,"CLOSE_TIGHT":3,"_END":4,"_COUNT":4},"SplitterPosition":{"_BEGIN":0,"LEFT":0,"RIGHT":1,"_END":2,"_COUNT":2},"DispensingSettings":{"_BEGIN":0,"Amount":0,"Time":1,"_END":2,"_COUNT":2}},"constants":{"DispensingEventMax":4}}');function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}function t(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(n){if("string"==typeof n)return r(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(n,e):void 0}}(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var o=0,a=function(){};return{s:a,n:function(){return o>=n.length?{done:!0}:{done:!1,value:n[o++]}},e:function(n){throw n},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return s=n.done,n},e:function(n){l=!0,i=n},f:function(){try{s||null==t.return||t.return()}finally{if(l)throw i}}}}function r(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function o(n,r){"object"==e(n)&&(r=n,n="div");var o=document.createElement(n);for(var a in r){var i=r[a];if("class"==a||"classes"==a||"classList"==a){"string"==typeof i&&(i=i.split(" "));var s,l=t(i);try{for(l.s();!(s=l.n()).done;){var c=s.value;(c=c.trim())&&o.classList.add(c.trim())}}catch(n){l.e(n)}finally{l.f()}}else if("style"==a)if("string"==typeof i)o.style=i;else for(var u in i)o.style[u]=i[u];else"parent"==a?i.appendChild(o):"text"==a?o.textContent=i:o[a]=i}return window.componentHandler&&window.componentHandler.upgradeElement(o),o}function a(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}window.downloadToFile=function(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/plain",r=new Blob([n],{type:t});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(r,e);else{var o=document.createElement("a");o.download=e;var a=URL.createObjectURL(r);o.href=a,document.body.appendChild(o),o.click(),setTimeout((function(){document.body.removeChild(o),window.URL.revokeObjectURL(a)}),0)}};var i,s=n.enums,l=n.constants,c=s.Commands,u=o({parent:document.body,class:"root"}),p=(o("img",{parent:u,class:"saved-img",src:"http://cat.lapinozz.com/saved-photo"}),o("img",{parent:u,class:"stream-img"})),f=o({parent:u,class:"dispensing-events-container ut-flex-h"}),d=o({parent:u,class:"secret-container ut-text-input-container"}),g=(o({parent:d,class:"secret-label ut-label",text:"Code"}),o("input",{parent:d,class:"secret-input",type:"password"})),v=o("input",{parent:d,class:"connect",type:"button",value:"Connect"}),m=o({parent:u,class:"log ut-readonly ut-flex-expand",readOnly:!0,contentEditable:!1}),y=o({parent:u,class:"command-container ut-text-input-container"}),S=(o({parent:y,class:"command-label ut-label",text:"Command"}),o("input",{parent:y,class:"command-input ut-flex-expand"})),b=o("input",{parent:y,class:"command-send",type:"button",value:"Send"});function h(n,e){o({parent:m,class:"log-msg",text:n,style:"color: "+e}),m.scrollTop=m.scrollHeight}function _(n,e){h(n+"\n",e)}function w(n,e){h("< "+n+"\n",e)}g.value=localStorage.getItem("secret")||"",g.onchange=function(){localStorage.setItem("secret",g.value)},g.onkeydown=function(n){13==n.keyCode&&C()},S.onkeydown=function(n){13==n.keyCode&&A()},b.onclick=A,console.log({sharedJson:n});var E=!1,O=!1;function D(){v.classList.toggle("disabled",E||O),y.classList.toggle("disabled",!E)}D(),setInterval((function(){i&&i.send("ping")}),1e3);var C=function(){i&&i.onclose();var n="ws://home.lapinozz.com:4560/ws/";i=new WebSocket(n+g.value),_("[WS] Conneting to: "+n+"XXXXXXXXXXXX"),E=!1,O=!0,D(),i.onopen=function(n){_("[WS] Connected","green"),E=!0,O=!1,D()},i.onmessage=function(n){if(n.data instanceof Blob)URL.revokeObjectURL(p.src),p.src=URL.createObjectURL(n.data);else{h("> "+n.data+"\n",undefined);var e=n.data.split(",").map((function(n){return parseInt(n)}));if(e.splice(0,1)==c.ESP_SetDispensingSetting){T=[];for(var t=0;t<l.DispensingEventMax;t++){T[t]=[];for(var r=0;r<s.DispensingSettings._COUNT;r++)T[t][r]=e[t*s.DispensingSettings._COUNT+r]}x()}}},i.onclose=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_("[WS] Connection Closed"+(n.reason?": "+n.reason:""),n.wasClean?"":"red"),i.onopen=void 0,i.onmessage=void 0,i.onclose=void 0,i.close(),i=null,E=!1,O=!1,D()}},T=[],x=function(){f.innerHTML="";var n=o("table",{parent:f,class:"dispensing-table"}),e=o("tr",{parent:n});o("td",{parent:e});var t,r=Object.keys(s.DispensingSettings).filter((function(n){return"_"!=n[0]})),i=function(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(n){if("string"==typeof n)return a(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?a(n,e):void 0}}(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var r=0,o=function(){};return{s:o,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,l=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return s=n.done,n},e:function(n){l=!0,i=n},f:function(){try{s||null==t.return||t.return()}finally{if(l)throw i}}}}(r);try{for(i.s();!(t=i.n()).done;){var l=t.value;"_"!=l[0]&&o("td",{parent:e,class:"dispensing-table-header-"+l,innerText:l})}}catch(n){i.e(n)}finally{i.f()}for(var u=[],p=function(){for(var n=!1,e=0;e<T.length;e++)for(var t=0;t<r.length;t++)n=n||T[e][t]!=u[e][t];v.classList.toggle("disabled",!n)},d=function(e){var t=T[e];u[e]=[];for(var a=o("tr",{parent:n,class:"dispensing-event-container"}),i=(o("td",{parent:a,class:"dispensing-setting-container",innerText:"Dispensing ".concat(e)}),function(n){var i=t[n];u[e][n]=i;var l=o("td",{parent:a,class:"dispensing-setting-container dispensing-table-"+r[n]}),c=o("input",{parent:l,class:"dispensing-setting-input"});n==s.DispensingSettings.Time?(c.type="time",c.value=new Date(1e3*i).toISOString().substring(11,16),c.onchange=function(){var t=c.value.split(":").reverse().reduce((function(n,e,t){return n+e*Math.pow(60,t+1)}),0);u[e][n]=t,p()}):n==s.DispensingSettings.Amount&&(c.type="number",c.min=0,c.max=100,c.value=i,o("span",{parent:l,innerText:"%",style:"margin:2px"}),c.onchange=function(){var t=Math.min(100,Math.max(0,parseInt(c.value)));u[e][n]=t,p()})}),l=0;l<r.length;l++)i(l)},g=0;g<T.length;g++)d(g);var v=o("input",{type:"button",parent:f,class:"set-dispensing-events-button",value:"Set",style:"height:2rem;align-self:end",onclick:function(){for(var n=0;n<T.length;n++)for(var e=0;e<r.length;e++){var t=T[n][e],o=u[n][e];t!=o&&(T[n][e]=o,A([c.ESP_SetDispensingSetting,n,e,o].join(",")))}A(c.ESP_SaveDispensingSettings),p()}});p()};v.onclick=C,C();var A=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;void 0===n&&(n=S.value,S.value=""),w(n),i.send(n)}})();